# https://docs.docker.com/compose/compose-file
web:
  restart: always
  build: .
  ports: 
    - "5000:5000"
  expose:
    - "5000"
  links:
    - postgres:postgres
    - postgres_test:postgres_test
    - redis:redis
  volumes:
    - .:/usr/src/app/
  env_file: .env
  command: python manage.py runserver


data:
  image: postgres:latest
  volumes:
    - /var/lib/postgresql
  command: "true"

postgres:
  restart: always
  image: postgres:latest
  volumes_from:
    - data
  ports:
    - "5432:5432"

redis:
  restart: always
  image: redis:alpine
  ports:
    - "6379:6379"
  hostname: "redis_host"


# separate db for tests
data_test:
  image: postgres:latest
  volumes:
    - /var/lib/postgresql
  command: "true"

postgres_test:
  restart: always
  image: postgres:latest
  volumes_from:
    - data_test
  ports:
    - "5433:5432"
